<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel w≈Ça≈õciciela</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>üè† Panel w≈Ça≈õciciela</h1>

  <div class="actions">
    <button class="btn btn-primary" onclick="window.location.href='add-property.html'">‚ûï Dodaj obiekt</button>
    <button class="btn btn-secondary" onclick="window.location.href='bookings.html'">üìÖ Rezerwacje</button>
  </div>

  <div id="propertiesContainer" class="cards"></div>

  <script>
    const API_PROPERTIES = "/properties";
    const API_ROOMS = "/rooms";
    const token = localStorage.getItem("token");

    async function loadProperties() {
      const res = await fetch(API_PROPERTIES, {
        headers: { "Authorization": "Bearer " + token }
      });
      const properties = await res.json();

      const container = document.getElementById("propertiesContainer");
      container.innerHTML = "";

      if (properties.length === 0) {
        container.innerHTML = "<p>Brak dodanych obiekt√≥w.</p>";
        return;
      }

      for (const p of properties) {
        const card = document.createElement("div");
        card.classList.add("card");

        const header = document.createElement("h2");
        header.textContent = p.name;
        card.appendChild(header);

        const address = document.createElement("p");
        address.textContent = p.address || "(brak adresu)";
        card.appendChild(address);

        const btns = document.createElement("div");
        btns.classList.add("actions");
        btns.innerHTML = `
          <button class="btn btn-primary" onclick="window.location.href='edit-property.html?id=${p.id}'">‚úè Edytuj</button>
          <button class="btn btn-secondary" onclick="showRooms(${p.id})">üõè Pokoje</button>
        `;
        card.appendChild(btns);

        const roomsDiv = document.createElement("div");
        roomsDiv.id = "rooms-" + p.id;
        roomsDiv.classList.add("rooms");
        card.appendChild(roomsDiv);

        container.appendChild(card);
      }
    }

    async function showRooms(propertyId) {
      const res = await fetch(`${API_ROOMS}?property_id=${propertyId}`, {
        headers: { "Authorization": "Bearer " + token }
      });
      const rooms = await res.json();

      const div = document.getElementById("rooms-" + propertyId);
      div.innerHTML = "";

      if (rooms.length === 0) {
        div.innerHTML = "<p>Brak pokoi. <a href='add-room.html?property_id=" + propertyId + "'>Dodaj pok√≥j</a></p>";
        return;
      }

      const list = document.createElement("ul");
      rooms.forEach(r => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${r.name}</strong> (max ${r.capacity} os.)
          <button class="btn btn-primary" onclick="window.location.href='edit-room.html?id=${r.id}'">‚úè Edytuj</button>
          <button class="btn btn-secondary" onclick="window.location.href='bookings.html?room_id=${r.id}'">üìÖ Kalendarz</button>
        `;
        list.appendChild(li);
      });
      div.appendChild(list);
    }

    loadProperties();
  </script>
</body>
</html>
