<main class="container">
  <h2>Twoje obiekty</h2>
  <div id="propertiesList" class="stats"></div>
  <a href="/add-property.html" class="btn">+ Dodaj nowy obiekt</a>
</main>

<script>
async function loadProperties() {
  const token = localStorage.getItem("token");
  if (!token) {
    document.getElementById("propertiesList").innerHTML = "<p>Musisz się zalogować</p>";
    return;
  }

  const res = await fetch("/api/properties", {
    headers: { "Authorization": "Bearer " + token }
  });
  const data = await res.json();

  const list = document.getElementById("propertiesList");
  list.innerHTML = "";

  if (data.length === 0) {
    list.innerHTML = "<p>Nie masz jeszcze żadnych obiektów.</p>";
    return;
  }

  data.forEach(p => {
    const div = document.createElement("div");
    div.className = "stat-box";
    div.innerHTML = `
      <h3>${p.name}</h3>
      <p>${p.address || "Brak adresu"}</p>
      <small>${p.description || ""}</small>
      <div style="margin-top:10px;">
        <button onclick="deleteProperty(${p.id})" class="btn-secondary">Usuń</button>
      </div>
    `;
    list.appendChild(div);
  });
}

async function deleteProperty(id) {
  const token = localStorage.getItem("token");
  if (!confirm("Na pewno usunąć obiekt?")) return;

  const res = await fetch("/api/properties/" + id, {
    method: "DELETE",
    headers: { "Authorization": "Bearer " + token }
  });

  if (res.ok) {
    alert("Obiekt usunięty");
    loadProperties();
  } else {
    const data = await res.json();
    alert("Błąd: " + data.error);
  }
}

loadProperties();
</script>
