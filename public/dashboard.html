<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AWON - Dashboard</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>Witaj w AWON!</h1>
    <button id="logoutBtn">Wyloguj siƒô</button>
  </header>

  <main>
    <section>
      <h2>Twoje konto</h2>
      <p>Email: <span id="user-email"></span></p>
      <p>Rola: <span id="user-role"></span></p>
    </section>

    <section>
      <h2>Twoje rezerwacje</h2>
      <div id="bookings-list">
        <p>≈Åadowanie rezerwacji...</p>
      </div>
    </section>

    <!-- ‚úÖ Panel administratora -->
    <section id="admin-panel" style="display:none; margin-top: 30px; border-top: 2px solid #ccc; padding-top: 20px;">
      <h2>‚öôÔ∏è Panel administratora</h2>
      <ul>
        <li><a href="manage-users.html">üë§ ZarzƒÖdzanie u≈ºytkownikami</a></li>
        <li><a href="all-bookings.html">üìÖ Wszystkie rezerwacje</a></li>
        <li><a href="reports.html">üìä Raporty</a></li>
      </ul>
    </section>
  </main>

  <script>
    // Sprawdzenie zalogowanego u≈ºytkownika
    const token = localStorage.getItem("token");
    const user = JSON.parse(localStorage.getItem("user"));

    if (!token || !user) {
      window.location.href = "login.html";
    }

    document.getElementById("user-email").textContent = user.email;
    document.getElementById("user-role").textContent = user.role;

    // ‚úÖ Je≈õli admin -> poka≈º panel
    if (user.role === "admin") {
      document.getElementById("admin-panel").style.display = "block";
    }

    // Obs≈Çuga wylogowania
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      window.location.href = "login.html";
    });

    // Pobranie rezerwacji u≈ºytkownika
    async function loadBookings() {
      try {
        const res = await fetch("/api/bookings", {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const data = await res.json();

        const bookingsDiv = document.getElementById("bookings-list");
        bookingsDiv.innerHTML = "";

        if (data.length === 0) {
          bookingsDiv.innerHTML = "<p>Brak rezerwacji.</p>";
        } else {
          data.forEach(b => {
            const el = document.createElement("div");
            el.textContent = `Rezerwacja ID: ${b.id}, Pok√≥j: ${b.room_id}, Od: ${b.start_date}, Do: ${b.end_date}`;
            bookingsDiv.appendChild(el);
          });
        }
      } catch (err) {
        document.getElementById("bookings-list").innerHTML = "<p>B≈ÇƒÖd pobierania rezerwacji.</p>";
      }
    }

    loadBookings();
  </script>
</body>
</html>
