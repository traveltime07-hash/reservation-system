<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel obiektu</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="dashboard">
    <h1 id="propertyName">üè° Panel obiektu</h1>
    <button onclick="window.location.href='dashboard.html'">‚¨Ö Powr√≥t do wszystkich obiekt√≥w</button>

    <h2>Lista pokoi</h2>
    <div id="roomsList"></div>
  </div>

  <script>
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "login.html";
    }

    const urlParams = new URLSearchParams(window.location.search);
    const propertyId = urlParams.get("property_id");

    if (!propertyId) {
      alert("Brak ID obiektu. Wejd≈∫ przez panel g≈Ç√≥wny.");
      window.location.href = "dashboard.html";
    }

    async function loadProperty() {
      try {
        // Pobierz szczeg√≥≈Çy obiektu
        const propRes = await fetch(`/api/properties/${propertyId}`, {
          headers: { "Authorization": `Bearer ${token}` }
        });
        if (!propRes.ok) throw new Error("Nie uda≈Ço siƒô pobraƒá obiektu");
        const property = await propRes.json();
        document.getElementById("propertyName").innerText = `üè° ${property.name} ‚Äì panel obiektu`;

        // Pobierz listƒô pokoi
        const res = await fetch(`/api/properties/${propertyId}/rooms`, {
          headers: { "Authorization": `Bearer ${token}` }
        });
        if (!res.ok) throw new Error("Nie uda≈Ço siƒô pobraƒá pokoi");

        const rooms = await res.json();
        const roomsList = document.getElementById("roomsList");
        roomsList.innerHTML = "";

        if (rooms.length === 0) {
          roomsList.innerHTML = "<p>Brak pokoi w tym obiekcie.</p>";
          return;
        }

        rooms.forEach(room => {
          const div = document.createElement("div");
          div.classList.add("room-card");
          div.innerHTML = `
            <h3>${room.name} (${room.capacity} os.)</h3>
            <p>${room.description || "Brak opisu"}</p>
            <button onclick="window.location.href='add-booking.html?property_id=${propertyId}&room_id=${room.id}'">
              ‚ûï Dodaj rezerwacjƒô
            </button>
            <button onclick="window.location.href='room-bookings.html?property_id=${propertyId}&room_id=${room.id}'">
              üìÖ ZarzƒÖdzaj rezerwacjami
            </button>
          `;
          roomsList.appendChild(div);
        });

      } catch (err) {
        alert(err.message);
      }
    }

    loadProperty();
  </script>
</body>
</html>
